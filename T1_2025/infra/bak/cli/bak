#!/usr/bin/env python3

import argparse
import requests

def cli():
    parser = argparse.ArgumentParser(description="Bak - Backup Management CLI")

    subparsers = parser.add_subparsers(dest="command")

    instance_parser = subparsers.add_parser("instance")
    instance_parser.add_argument("action", choices=["register", "update", "remove"])
    instance_parser.add_argument("--hostname", type=str)
    instance_parser.add_argument("--controller", type=str)
    instance_parser.add_argument("--tool", type=str)
    instance_parser.add_argument("--freq", type=str)
    instance_parser.add_argument("--copies", type=str)

    args = parser.parse_args()

    if args.command == "instance":
        if args.action == "register":
            add_instance_url = f"http://{args.controller}:8000/instance/?hostname={args.hostname}"
            requests.post(add_instance_url)

            add_policy_url = f"http://{args.controller}:8000/policy/"
            policy_data = {
                "hostname": args.hostname,
                "tool": args.tool,
                "freq": args.freq,
                "copies": int(args.copies)
            }

            requests.post(add_policy_url, json=policy_data)

if __name__ == "__main__":
    cli()
